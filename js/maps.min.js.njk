---
permalink: js/maps.min.js
eleventyExcludeFromCollections: true
---
{% set js %}
  var markerIcon = new L.Icon({
    iconUrl: '/img/marker-icon-blue.png',
    iconSize: [22, 36],
    iconAnchor: [12, 41],
    popupAnchor: [1, -34]
  });
  
  function map_init() {
      var map = L.map('map');

      var tiles = L.tileLayer('https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png', {
          maxZoom: 17,
          attribution: 'Map data: &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, <a href="http://viewfinderpanoramas.org">SRTM</a> | Map style: &copy; <a href="https://opentopomap.org">OpenTopoMap</a> (<a href="https://creativecommons.org/licenses/by-sa/3.0/">CC-BY-SA</a>)'
      }).addTo(map);

      return map;
  }

  function map_home() {
      var map = map_init();

      {%- for trailhead in hiketrailheads %}
          L.marker([{{ trailhead.latitude }}, {{ trailhead.longitude }}], { icon: markerIcon, title: '{{ trailhead.name }}' })
              .addTo(map)
              .bindPopup("<strong>{{ trailhead.name }}</strong><p>Hikes available from this trailhead:</p><ul>{% for hike in trailhead.hikes %}<li><a href='/hikes/{{ hike | slugify }}'>{{ hike }}</a></li>{% endfor %}</ul>");
      {%- endfor %}

      // manually set default bounds around core area
      map.fitBounds([
          [62.8921755, -149.7465986], // Little Coal Creek Trailhead
          [62.630615, -150.2281732],  // Upper Troublesome Creek Trailhead
          [60.0682518, -149.4426372], // Caines Head Trailhead
          [61.7779049, -147.7658421]  // Matanuska Glacier Trailhead
      ]);
  }

  {%- for hike in collections.hikes %}
      {%- if hike.data.trailheads | length %}
          function map_{{ hike.data.title | slugify | replace("-", "") }}() {
              var map = map_init();

                {%- for trailhead in hike.data.trailheads %}
                    L.marker([{{ trailhead.latitude }}, {{ trailhead.longitude }}], { icon: markerIcon, title: '{{ trailhead.name }}' })
                        .addTo(map)
                        .bindPopup("<strong>{{ trailhead.name }}</strong><p><a href='https://maps.google.com/maps?daddr={{ trailhead.latitude }},{{ trailhead.longitude }}&amp;ll=' target='_blank'>Get directions to this trailhead</a></p>");
                {%- endfor %}

                {%- if hike.data.trailheads | length == 1 %}
                    map.setView([{{ hike.data.trailheads[0].latitude }}, {{hike.data.trailheads[0].longitude }}], 11);
                {%- else %}
                    map.fitBounds([
                        {%- for trailhead in hike.data.trailheads %}
                            [{{ trailhead.latitude }}, {{ trailhead.longitude }}],
                        {%- endfor %}
                    ]);
                {%- endif %}
              
                {%- if hike.data.gpxFilename | length %}
                    var gpx = "/files/gpx/{{ hike.data.gpxFilename }}";
                    new L.GPX(gpx, {
                        async: true,
                        marker_options: {
                            startIconUrl: null,
                            endIconUrl: null,
                            shadowUrl: null
                        },
                        polyline_options: {
                            color: 'red'
                        }
                    }).on('loaded', function(e) {
                        map.fitBounds(e.target.getBounds());
                    }).addTo(map);
                {%- endif %}
          }
      {%- endif %}
  {%- endfor %}
{% endset %}
{{- js | jsmin | safe }}
